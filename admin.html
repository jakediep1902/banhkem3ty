<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - C·∫≠p Nh·∫≠t S·∫£n Ph·∫©m</title>
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
</head>
<body>
    <header class="main-header">
        <h1>üîß Qu·∫£n l√Ω s·∫£n ph·∫©m</h1>
    </header>

    <main>
        <form id="updateProductForm">
            <label for="productName">T√™n s·∫£n ph·∫©m:</label>
            <input type="text" id="productName" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." required>

            <label for="newPrice">Gi√° m·ªõi (VNƒê/kg):</label>
            <input type="number" id="newPrice" placeholder="Nh·∫≠p gi√° m·ªõi..." required>

            <label for="imageUrl">URL H√¨nh ·∫£nh:</label>
            <input type="url" id="imageUrl" placeholder="Nh·∫≠p URL h√¨nh ·∫£nh..." required>
            <button onclick="window.open('https://postimages.org/', '_blank')">üì∑ Upload ·∫£nh t·∫°i PostImage v√† l·∫•y URL</button>

            <button type="submit">C·∫≠p Nh·∫≠t</button>

        </form>
        <!-- <form id="deleteProductForm">
            <label for="deleteProductName">T√™n s·∫£n ph·∫©m c·∫ßn x√≥a:</label>
            <input type="text" id="deleteProductName" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." required>
            <button type="submitdelete">üóë X√≥a S·∫£n Ph·∫©m</button>
        </form> -->
        
        <p id="deleteStatusMessage"></p>
        

        <p id="statusMessage"></p>
    </main>

    <footer>
        <a href="index.html">üè† Quay l·∫°i trang ch·ªß</a>
    </footer>

    <script>
      
     
      const titleID = GetTitleID();
      const secretKey = GetSCkey();




function isImageURLValid(url) {
    return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => resolve(true);  // ·∫¢nh load th√†nh c√¥ng -> URL h·ª£p l·ªá
        img.onerror = () => resolve(false); // L·ªói khi load ·∫£nh -> URL kh√¥ng h·ª£p l·ªá
        img.src = url;
    });
}


// X·ª≠ l√Ω s·ª± ki·ªán g·ª≠i form
document.getElementById("updateProductForm").addEventListener("submit", async function(event) {
    event.preventDefault(); // NgƒÉn ch·∫∑n reload trang

    const url = `https://${titleID}.playfabapi.com/Admin/SetTitleData`;
    //const secretKey = "MWDS187QTJODWIYBH3B4U4BOHGQ97Y8AWZPGK9YKK66PZEDAZN"; // üî¥ THAY TH·∫æ B·∫∞NG SECRET KEY C·ª¶A B·∫†N

    
    const productName = document.getElementById("productName").value.trim();
    const newPrice = document.getElementById("newPrice").value.trim();
    const imageUrl = document.getElementById("imageUrl").value.trim();
    const statusMessage = document.getElementById("statusMessage");

    if (!productName || !newPrice || !imageUrl) {
        statusMessage.innerText = "‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!";
        statusMessage.style.color = "red";
        return;
    }

    // Ki·ªÉm tra URL h√¨nh ·∫£nh tr∆∞·ªõc khi g·ª≠i d·ªØ li·ªáu
    statusMessage.innerText = "üîÑ ƒêang ki·ªÉm tra URL h√¨nh ·∫£nh...";
    statusMessage.style.color = "blue";

    const isValidImage = await isImageURLValid(imageUrl);
    
    if (!isValidImage) {
        statusMessage.innerText = "‚ùå URL h√¨nh ·∫£nh kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p URL kh√°c.";
        statusMessage.style.color = "red";
        return;
    }

    try {
        // G·ª≠i d·ªØ li·ªáu s·∫£n ph·∫©m l√™n PlayFab
        const response = await fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-SecretKey": secretKey
            },
            body: JSON.stringify({
                "Key": productName,
                "Value": JSON.stringify({
                    "price": newPrice,
                    "image": imageUrl
                })
            })
        });

        const result = await response.json();
        console.log("Response:", result);

        if (response.ok) {
            statusMessage.innerText = `‚úÖ S·∫£n ph·∫©m "${productName}" ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!`;
            statusMessage.style.color = "green";
        } else {
            statusMessage.innerText = `‚ùå L·ªói: ${result.errorMessage || "Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t s·∫£n ph·∫©m"}`;
            statusMessage.style.color = "red";
        }
    } catch (error) {
        console.error("Error:", error);
        statusMessage.innerText = "‚ùå L·ªói k·∫øt n·ªëi!";
        statusMessage.style.color = "red";
    }
});



document.getElementById("deleteProductForm").addEventListener("submit", async function(event) {
    event.preventDefault(); // NgƒÉn reload trang
    
    const productName = document.getElementById("deleteProductName").value.trim();
    if (!productName) {
        alert("Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m!");
        return;
    }

    // G·ª≠i request l√™n PlayFab ƒë·ªÉ c·∫≠p nh·∫≠t gi√° v·ªÅ 0
    const requestData = {
        "Key": productName,
        "Value": "0"
    };

    try {
        const response = await fetch("https://1522DF.playfabapi.com/Admin/SetTitleData", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-SecretKey": secretKey,
            },
            body: JSON.stringify(requestData)
        });

        const result = await response.json();
        if (result.code === 200) {
            alert(`ƒê√£ c·∫≠p nh·∫≠t gi√° s·∫£n ph·∫©m "${productName}" th√†nh <0.`);
        } else {
            console.error("L·ªói t·ª´ PlayFab:", result);
            alert("C·∫≠p nh·∫≠t kh√¥ng th√†nh c√¥ng!");
        }
    } catch (error) {
        console.error("L·ªói khi g·ª≠i request:", error);
        alert("L·ªói k·∫øt n·ªëi ƒë·∫øn PlayFab!");
    }
});

    </script>
</body>
</html>
